<!DOCTYPE html>
<head>
    <title>Agentforce Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <h1>Agentforce Testing v4.0</h1>
    <p id="ip-address"></p>
    <script type='text/javascript'>
        function initEmbeddedMessaging() {
            try {
                //Fetch IP Address
                /*
                document.addEventListener("DOMContentLoaded", function() {
                    // Fetch the IP address from the API
                    fetch("https://ipinfo.io/json") 
                        .then(response => response.json())
                        .then(data => {
                            // Display the IP address on the screen
                            document.getElementById("ip-address").textContent = 
                                  `IP Address: ${data.ip}`;
                        })
                        .catch(error => {
                            console.error("Error fetching IP address:", error);
                            document.getElementById("ip-address").textContent = 
                                  "Unable to retrieve IP address.";
                        });
                });*/

                document.addEventListener("DOMContentLoaded", function() {
                    // Fetch the IP address from the API
                    fetch("https://api.ipify.org?format=json")
                        .then(response => response.json())
                        .then(data => {
                            // Display the IP address on the screen
                            document.getElementById("ip-address").textContent = data.ip;
                        })
                        .catch(error => {
                            console.error("Error fetching IP address:", error);
                        });
                });

                embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'

                // Add the current page URL to pre-chat data
                /*
                embeddedservice_bootstrap.settings.extraPrechatInfo = [{
                    name: 'hostPageUrl',
                    value: window.location.href,
                    displayToAgent: true  // Agents will see this in the conversation
                }];
                
*/
                // Wait for the Embedded Service Chat to be ready
                window.addEventListener("onEmbeddedMessagingReady", function() {
                    // Get current page URL
                    var currentPageURL = window.location.href;

                    console.log('Page URL:::: ' + currentPageURL);

                    // Set the URL as a pre-chat field
                    embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
                        "Current_Page_URL": currentPageURL
                    });
                });
    
                embeddedservice_bootstrap.init(
                    '00DgL000000lTEf',
                    'Agentforce_Test',
                    'https://orgfarm-ee80b2920b-dev-ed.develop.my.site.com/ESWAgentforceTest1742373017342',
                    {
                        scrt2URL: 'https://orgfarm-ee80b2920b-dev-ed.develop.my.salesforce-scrt.com'
                    }
                );
            } catch (err) {
                console.error('Error loading Embedded Messaging: ', err);
            }
        };
    </script>
    <script type='text/javascript' src='https://orgfarm-ee80b2920b-dev-ed.develop.my.site.com/ESWAgentforceTest1742373017342/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
    
</body>